<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="Teams.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <title>Teams</title>
</head>
<body>
  <header>
    <div class="header-content">
      <h1><a href="Homepage.html">Morningside eSports</a></h1>
      <nav class="top-nav">
        <a href="Teams.html">TEAMS</a>
        <a href="Match History.html">MATCH HISTORY</a>
        <a href="Origins.html">ORIGINS</a>
      </nav>
    </div>
    <nav class="bottom-nav">
      <div class="nav-container">
        <h2 class="game-nav">
          <span><a href="#overwatch">Overwatch</a></span>
          <span><a href="#valorant">Valorant</a></span>
          <span><a href="#rocket-league">Rocket League</a></span>
          <span><a href="#past-teams">Past Teams</a></span>
        </h2>
        <div class="year">
          <p>Year:
            <select id="year-select" class="year-select">
              <option value="2024-2025" selected>2024-2025</option>
              <option value="2023-2024">2023-2024</option>
              <option value="2022-2023">2022-2023</option>
              <option value="Previous">Previous Rosters</option>
            </select>
          </p>
        </div>
      </div>
    </nav>
  </header>

  <div class="content">
    <div id="teams-container"></div>
  </div>

  <footer>
    <div class="social-media">
      <a href="https://x.com/msideesports?lang=en" target="_blank">TWITTER</a>
      <a href="https://www.instagram.com/morningsideesports/" target="_blank">INSTAGRAM</a>
      <a href="https://www.tiktok.com/@msideesports" target="_blank">TIKTOK</a>
      <a href="https://www.twitch.tv/msideesports" target="_blank">TWITCH</a>
      <a href="https://www.msidemustangs.com/recruits/esports" target="_blank">RECRUIT ME</a>
    </div>
  </footer>

  <script>
    const SHEET_ID = '1bTm8NIywfWXU03Z7YuSUNAFX0sWvtOgg73Lqwipp4HM';
    const API_KEY = '5938c4cd54e3923baaf11bbf5280f18d85ac027c';
    const RANGE = 'Sheet1!A:D'; // Adjust if your sheet has more/less columns

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const [headers, ...rows] = data.values;
        const people = rows.map(row =>
          Object.fromEntries(headers.map((key, i) => [key, row[i] || ""]))
        );

        const grouped = {};

        // Sort everyone into team > level
        for (const person of people) {
          const team = person.Team || 'Unknown Team';
          const level = person.Level?.toUpperCase() === 'V' ? 'Varsity' : 'Junior Varsity';
          if (!grouped[team]) grouped[team] = { Varsity: [], 'Junior Varsity': [] };
          grouped[team][level].push(person);
        }

        const container = document.getElementById('teams-container');

        for (const [team, levels] of Object.entries(grouped)) {
          const section = document.createElement('div');
          section.classList.add('team-section');

          const title = document.createElement('h2');
          title.textContent = team;
          title.classList.add('team-title');
          section.appendChild(title);

          for (const level of ['Varsity', 'Junior Varsity']) {
            const members = levels[level];
            if (members.length === 0) continue;

            const levelTitle = document.createElement('h3');
            levelTitle.textContent = level;
            levelTitle.classList.add('level-title');
            section.appendChild(levelTitle);

            // Sort with Coach first
            members.sort((a, b) => (a.Position === 'Coach' ? -1 : 1));

            const list = document.createElement('ul');
            list.classList.add('member-list');

            for (const { Name, Position } of members) {
              const item = document.createElement('li');
              item.textContent = `${Name} - ${Position}`;
              list.appendChild(item);
            }

            section.appendChild(list);
          }

          container.appendChild(section);
        }
      })
      .catch(err => {
        console.error('Error fetching Google Sheet:', err);
        document.getElementById('teams-container').innerHTML = '<p>Error loading team data.</p>';
      });
  </script>
</body>
</html>
